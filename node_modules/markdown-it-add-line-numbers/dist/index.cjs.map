{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import markdownit from 'markdown-it';\nimport type { Options, Renderer, Token } from 'markdown-it';\n// @ts-ignore\nimport imageFigures from 'markdown-it-image-figures';\nimport { parse } from 'node-html-parser';\n\nconst parseHtmlBlockPlugin = (md: markdownit, level = 0) => {\n  function parseHtmlBlock(tokens: Token[], idx: number, options: Options, env: any, slf: Renderer) {\n    const parser = build_parser(level + 1);\n    // console.log(parser.render('\\n' + tokens[idx].content.replace(/\\n/g, '\\n\\n') + '\\n'));\n    const x = parse(parser.render('\\n' + tokens[idx].content.replace(/\\n/g, '\\n\\n') + '\\n'));\n    // console.log(x.range);\n    return parser.render('\\n' + tokens[idx].content.replace(/\\n/g, '\\n\\n') + '\\n');\n  }\n  md.renderer.rules.html_block = (tokens: Token[], idx: number, options: Options, env: any, slf: Renderer) => {\n    return parseHtmlBlock(tokens, idx, options, env, slf);\n  };\n  md.renderer.rules.html_inline = (tokens: Token[], idx: number, options: Options, env: any, slf: Renderer) => {\n    return parseHtmlBlock(tokens, idx, options, env, slf);\n  };\n};\n\nconst addLineNumbers = (md: markdownit, level = 0) => {\n  function _addLineNumbers(tokens: Token[], idx: number, options: Options, env: any, slf: Renderer) {\n    if (tokens[idx].map) {\n      const line = level === 0 ? tokens[idx].map[0] : (tokens[idx].map[0] - 1) / 2 + 3;\n      tokens[idx].attrSet('data-source-line', String(line));\n    }\n    return slf.renderToken(tokens, idx, options);\n  }\n  md.renderer.rules.blockquote_open = _addLineNumbers;\n  md.renderer.rules.bullet_list_open = _addLineNumbers;\n  md.renderer.rules.heading_open = _addLineNumbers;\n  md.renderer.rules.hr = _addLineNumbers;\n  md.renderer.rules.link_open = _addLineNumbers;\n  md.renderer.rules.list_item_open = _addLineNumbers;\n  md.renderer.rules.ordered_list_open = _addLineNumbers;\n  md.renderer.rules.paragraph_open = _addLineNumbers;\n  md.renderer.rules.table_open = _addLineNumbers;\n  md.renderer.rules.td_open = _addLineNumbers;\n  md.renderer.rules.th_open = _addLineNumbers;\n  md.renderer.rules.tr_open = _addLineNumbers;\n};\n\nconst build_parser = (level = 0) => {\n  const md = markdownit({\n    html: true,\n    linkify: true,\n    typographer: true,\n    xhtmlOut: true,\n  });\n  md.use(imageFigures);\n  md.use((md) => addLineNumbers(md, level));\n  return md;\n};\n\nexport const addLineNumbersPlugin = (md: markdownit) => {\n  md.use(addLineNumbers);\n  md.use(parseHtmlBlockPlugin);\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAuB;AAGvB,uCAAyB;AACzB,8BAAsB;AAEtB,IAAM,uBAAuB,CAAC,IAAgB,QAAQ,MAAM;AAC1D,WAAS,eAAe,QAAiB,KAAa,SAAkB,KAAU,KAAe;AAC/F,UAAM,SAAS,aAAa,QAAQ,CAAC;AAErC,UAAM,QAAI,+BAAM,OAAO,OAAO,OAAO,OAAO,GAAG,EAAE,QAAQ,QAAQ,OAAO,MAAM,IAAI,IAAI,CAAC;AAEvF,WAAO,OAAO,OAAO,OAAO,OAAO,GAAG,EAAE,QAAQ,QAAQ,OAAO,MAAM,IAAI,IAAI;AAAA,EAC/E;AACA,KAAG,SAAS,MAAM,aAAa,CAAC,QAAiB,KAAa,SAAkB,KAAU,QAAkB;AAC1G,WAAO,eAAe,QAAQ,KAAK,SAAS,KAAK,GAAG;AAAA,EACtD;AACA,KAAG,SAAS,MAAM,cAAc,CAAC,QAAiB,KAAa,SAAkB,KAAU,QAAkB;AAC3G,WAAO,eAAe,QAAQ,KAAK,SAAS,KAAK,GAAG;AAAA,EACtD;AACF;AAEA,IAAM,iBAAiB,CAAC,IAAgB,QAAQ,MAAM;AACpD,WAAS,gBAAgB,QAAiB,KAAa,SAAkB,KAAU,KAAe;AAChG,QAAI,OAAO,GAAG,EAAE,KAAK;AACnB,YAAM,OAAO,UAAU,IAAI,OAAO,GAAG,EAAE,IAAI,CAAC,KAAK,OAAO,GAAG,EAAE,IAAI,CAAC,IAAI,KAAK,IAAI;AAC/E,aAAO,GAAG,EAAE,QAAQ,oBAAoB,OAAO,IAAI,CAAC;AAAA,IACtD;AACA,WAAO,IAAI,YAAY,QAAQ,KAAK,OAAO;AAAA,EAC7C;AACA,KAAG,SAAS,MAAM,kBAAkB;AACpC,KAAG,SAAS,MAAM,mBAAmB;AACrC,KAAG,SAAS,MAAM,eAAe;AACjC,KAAG,SAAS,MAAM,KAAK;AACvB,KAAG,SAAS,MAAM,YAAY;AAC9B,KAAG,SAAS,MAAM,iBAAiB;AACnC,KAAG,SAAS,MAAM,oBAAoB;AACtC,KAAG,SAAS,MAAM,iBAAiB;AACnC,KAAG,SAAS,MAAM,aAAa;AAC/B,KAAG,SAAS,MAAM,UAAU;AAC5B,KAAG,SAAS,MAAM,UAAU;AAC5B,KAAG,SAAS,MAAM,UAAU;AAC9B;AAEA,IAAM,eAAe,CAAC,QAAQ,MAAM;AAClC,QAAM,SAAK,mBAAAA,SAAW;AAAA,IACpB,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,UAAU;AAAA,EACZ,CAAC;AACD,KAAG,IAAI,iCAAAC,OAAY;AACnB,KAAG,IAAI,CAACC,QAAO,eAAeA,KAAI,KAAK,CAAC;AACxC,SAAO;AACT;AAEO,IAAM,uBAAuB,CAAC,OAAmB;AACtD,KAAG,IAAI,cAAc;AACrB,KAAG,IAAI,oBAAoB;AAC7B;","names":["markdownit","imageFigures","md"]}